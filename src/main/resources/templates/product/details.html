<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Product Details</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="/css/base.css">
    <link rel="stylesheet" href="/css/product-details.css">
</head>
<body>
<div class="container">
    <a href="/products" class="back-button">Back to Product List</a>

    <div class="product-details">
        <h1 th:text="${product.title}"></h1>
        <img th:src="${product.imageUrl}" alt="Product Image" />

        <h3>Description</h3>
        <p class="description" th:text="${product.description}"></p>
        <h3>Details</h3>
        <p class="extended-description" th:text="${product.extendedDescription}"></p>

        <div class="pricing">
            <h3>Pricing Details</h3>
            <p>Base Price: <span th:text="'$' + ${product.price}"></span></p>
            <p>Delivery Options:</p>
            <ul>
                <li>Paczkomat: <span th:text="'$' + ${product.paczkomatPrice}"></span></li>
                <li>Poczta: <span th:text="'$' + ${product.pocztaPrice}"></span></li>
                <li>Kurier: <span th:text="'$' + ${product.kurierPrice}"></span></li>
            </ul>
            <p>Available Stock: <span th:text="${product.stockQuantity}"></span></p>
        </div>

        <form th:action="@{'/products/' + ${product.id} + '/add-to-cart'}" method="post" class="cart-form">
            <label for="quantity">Quantity:</label>
            <input type="number" name="quantity" id="quantity" min="1" max="${product.stockQuantity}" value="1" />
            <button type="submit" class="add-to-cart-button">Add to Cart</button>
        </form>

        <div class="reviews">
            <h3>Average Rating: <span th:text="${#numbers.formatDecimal(averageRating, 1, 1)} + ' / 5'"></span></h3>
            <div class="stars">
                <i th:each="i : ${#numbers.sequence(1, 5)}"
                   th:classappend="${i <= T(java.lang.Math).round(averageRating)} ? 'fas fa-star' : 'far fa-star'"></i>
            </div>
            <h3>Reviews:</h3>
            <ul>
                <li th:each="review : ${product.reviews}">
                    <strong th:text="${review.username}"></strong>:
                    <span th:text="${review.comment}"></span>
                    <div class="stars">
                        <i th:each="i : ${#numbers.sequence(1, 5)}"
                           th:classappend="${i <= review.rating} ? 'fas fa-star' : 'far fa-star'"></i>
                    </div>
                </li>
            </ul>
        </div>

        <form th:action="@{'/products/' + ${product.id} + '/reviews'}" method="post">
            <h3>Add a Review:</h3>
            <label for="username">Name:</label>
            <input type="text" id="username" name="username" required />
            <label for="comment">Comment:</label>
            <textarea id="comment" name="comment" required></textarea>
            <label for="rating">Rating:</label>
            <select id="rating" name="rating" required>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>
            <button type="submit" class="add-review-button">Submit Review</button>
        </form>
    </div>
</div>
</body>
</html>
